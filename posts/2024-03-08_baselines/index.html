<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.3.450" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Nicholas Marino" />

<title>Nicholas Marino – Tudo começa de algum lugar - até mesmo a sua solução analítica</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">Nicholas Marino</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Procurar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Alternar de navegação"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="/about.html" rel="" target="">
 <span class="menu-text">Sobre</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="/cv/cv.html" rel="" target="">
 <span class="dropdown-text">Portugues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="/cv/cv-en.html" rel="" target="">
 <span class="dropdown-text">English</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
    <a href="https://github.com/nacmarino/blog" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo de leitor">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div id="quarto-toc-target"></div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default toc-left">
  <div class="quarto-title-banner">
    <div class="quarto-title column-body">
      <h1 class="title">Tudo começa de algum lugar - até mesmo a sua solução analítica</h1>
            <p class="subtitle lead"><p>A definição de um ponto de partida, um <em>baseline</em>, é vital no desenvolvimento de qualquer tipo de solução analítica. E, frequentemente, eu me pego falando sobre esse tema com pessoas cientistas de dados de todos os níveis de senioridade. Então, resolvi escrever esse post para compartilhar com um fórum maior o que eu normalmente ficou tagarelando com eles.</p></p>
                                <div class="quarto-categories">
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">estatistica</div>
                <div class="quarto-category">pov</div>
                <div class="quarto-category">r</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p><a href="nacmarino.netlify.app">Nicholas Marino</a> <a href="https://orcid.org/0000-0002-5702-5466" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Data de Publicação</div>
      <div class="quarto-title-meta-contents">
        <p class="date">12 de abril de 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Data de Modificação</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">18 de abril de 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Conteudo</h2>
   
  <ul>
  <li><a href="#o-science-em-data" id="toc-o-science-em-data">O <strong>Science</strong> em Data</a></li>
  <li><a href="#como-você-sabe-que-seu-modelo-é-bom" id="toc-como-você-sabe-que-seu-modelo-é-bom">Como você sabe que seu modelo é bom?</a></li>
  <li><a href="#baselines-de-livro-texto" id="toc-baselines-de-livro-texto">Baselines de livro-texto</a></li>
  <li><a href="#isso-não-está-nos-livros" id="toc-isso-não-está-nos-livros">Isso não está nos livros…</a></li>
  <li><a href="#para-além-de-algoritmos-preditivos" id="toc-para-além-de-algoritmos-preditivos">Para além de algoritmos preditivos</a></li>
  </ul>
</nav>
<section id="o-science-em-data" class="level1">
<h1>O <strong>Science</strong> em Data</h1>
<p>Comecei a minha carreira na academia, onde tive a oportunidade de aprender algumas coisas interessantes e incorporá-las à forma de pensar. Uma delas foi a habilidade de duvidar, questionar e criticar<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Existem casos em que é muito fácil exercitar essa habilidade, mas têm vezes que a questão não é tão trivial. Ainda assim, esse tipo de exercício tende a ser inconsciente para mim. Mas o que é que isso tem haver com Ciência de Dados?</p>
<p>Ás vezes me parece que passamos batido, mas existe a palavra <strong>ciência</strong> no nome daquela disciplina - e a ciência nos oferece um jeito muito poderoso de pensar, testar hipóteses e avaliar o que nos é mostrado. Por exemplo: como você sabe que A é melhor do que B, que uma intervenção funciona, que não tem diferença entre duas coisas…como saber se você realmente descobriu o que você diz ter descoberto<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>? O método científico é a resposta para estas perguntas, e ele nos ensina a pensar de forma estruturada para ir das nossas perguntas à respostas bem sustentadas. E essas são os tipos de coisas que estão diretamente relacionadas ao nosso dia a dia enquanto pessoas que trabalham com ciência de dados.</p>
<p>Com isso em mente, o objetivo desse post é falar um pouco mais sobre como pensar cientificamente no nosso dia a dia. Vamos focar primeiro em uma tarefa mais cotidiana, que é a modelagem preditiva; depois, vamos ver como esse tipo de pensamento faz parte não só da modelagem, mas de qualquer outra etapa de um projeto de Ciência de Dados.</p>
</section>
<section id="como-você-sabe-que-seu-modelo-é-bom" class="level1">
<h1>Como você sabe que seu modelo é bom?</h1>
<p>Quando pensamos em criar um modelo preditivo, geralmente o fazemos porquê achamos que de alguma forma ele vai ser melhor do que alguma outra coisa. Mas que coisa é essa? Isso é um ponto importante termos em mente quando começamos essa tarefa: precisamos ter um ponto de partida para definir se aquilo que estamos propondo vai ser melhor do que aquilo que já temos. O nome que damos ao que já temos é <em>baseline</em>.</p>
<p>É difícil chegarmos à uma regra geral para definir esse <em>baseline</em>, uma vez que temos diferentes tipos de problemas de dados (e.g., classificação, regressão, séries temporais,…) e de negócio. Além disso, cada um daqueles problemas de dados têm peculiaridades distintas, que balizam a forma como devemos definir um <em>baseline</em> - por exemplo, a dependência temporal entre observações pode ser muito informativa para séries temporais, mas ela está ausente em problemas de regressão tradicionais. Assim, cada problema traz uma abordagem diferente para a definição do <em>baseline</em>, mas todas elas convergem para o mesmo objetivo: nos ajudar a definir se o modelo realmente tem o potencial de trazer um benefício sobre o que já temos.</p>
</section>
<section id="baselines-de-livro-texto" class="level1">
<h1>Baselines de livro-texto</h1>
<p>Em um problema de classificação normalmente queremos fornecer pelo menos uma categoria à uma instância. Nesse caso, nosso ponto de partida - o <em>baseline</em> - pode ser uma abordagem mais simples, como se não houvesse nenhuma inteligência por traz do fenômeno em questão, e ‘dizermos’ que todas as observações pertencem à uma única categoria - normalmente àquela com maior frequência em nossa base de dados. Ao ‘chutarmos’ que toda a observação pertence à categoria mais frequente, estamos definindo um ponto de partida bem otimista para nossa tarefa de modelagem<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Essa noção é representada no exemplo abaixo<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># manipulação de dados</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># modelagem</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata) <span class="co"># dados</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext) <span class="co"># complementando ggplot2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#      Separando a base em treino e teste, e criando esquema de validação cruzada      #</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um split entre treino e teste, estratificando a separação da base pelo variável</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># que queremos usar no problema de classificação; além disso, setando uma constante para</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># o gerador de números aleatórios para garantir que vamos conseguir reproduzir o split</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>split_inicial <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> credit_data, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&#39;Status&#39;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um esquema de validação cruzada para poder estimar a performance média do modelo </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># e a sua variância</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> <span class="fu">training</span>(split_inicial), <span class="at">v =</span> <span class="dv">5</span>, <span class="at">strata =</span> <span class="st">&#39;Status&#39;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#        Estimando a performance do baseline: prevendo a classe mais frequente         #</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># estimando a classe mais frequente na base de treino: contando quantas vezes cada classe</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># aparece dentro da variável que queremos prever e, então, tirando o nome da classe mais </span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># comum</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>classe_frequente <span class="ot">&lt;-</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial) <span class="sc">%&gt;%</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Status) <span class="sc">%&gt;%</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">wt =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Status) <span class="sc">%&gt;%</span> </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a performance do baseline usando o esquema de validação cruzada - a ideia aqui</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># vai ser definir que todas as instancias em cada fold pertencem à classe mais frequente na </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># base de treino. Por termos estratificado a separação da base, teremos a mesma quantidade</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># (aproximada) de instância em cada fold, de forma que a acurácia do baseline será identica</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># entre folds, fazendo com que a variância na performance seja zero. Poderíamos ter calculado</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># essa performance direto na base de treino, mas achei melhor fazer desse jeito aqui por que</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># o método será similar e mais relevante quando pensamos no exemplo da regressão (onde, por</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># exemplo, vamos usar a média do valor que queremos prever como o baseline)</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>metricas_baseline_classe <span class="ot">&lt;-</span> splits <span class="sc">%&gt;%</span> </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate =</span> <span class="fu">map_int</span>(splits, <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">testing</span>(.)<span class="sc">$</span>Status <span class="sc">==</span> <span class="st">&#39;good&#39;</span>)) <span class="sc">/</span> <span class="fu">map_int</span>(splits, <span class="sc">~</span> <span class="fu">nrow</span>(<span class="fu">testing</span>(.))),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">origem    =</span> <span class="st">&#39;baseline&#39;</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">.metric   =</span> <span class="st">&#39;accuracy&#39;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">#            Ajustando e estimando a performance de um algoritmo preditivo             # </span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># criando uma regressão logística simples para o problema de classificação</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="do">## primeiro setando o algoritmo</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>algoritmo <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;glmnet&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="do">## criando o pré-processamento de dados que será aplicado durante o treinamento do modelo</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="do">## não há problema definir que o dado é de treinamento aqui, pois essa receita de</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="do">## pré-processamento só será treinada durante o ajuste do modelo</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>data_prep <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Status <span class="sc">~</span> Income <span class="sc">+</span> Amount <span class="sc">+</span> Debt <span class="sc">+</span> Price <span class="sc">+</span> Home <span class="sc">+</span> Job, </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="do">## conectando os dados com o algoritmo</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(algoritmo) <span class="sc">%&gt;%</span> </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(data_prep)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustando o algoritmo</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(<span class="at">object =</span> wf, <span class="at">resamples =</span> splits, </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy, mn_log_loss))</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo o valor da acurácia do modelo treinado - a escolha dessa métrica é duvidosa</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="co"># para esse tipo de problema, mas o exemplo aqui é apenas ilustrativo</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>metricas_modelo_classe <span class="ot">&lt;-</span> modelo <span class="sc">%&gt;%</span> </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;accuracy&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;modelo&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># juntando as metricas do baseline e do modelo e preparando o dado para criar a figura</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metricas_baseline_classe, metricas_modelo_classe) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate_std =</span> <span class="fu">sd</span>(.estimate), <span class="at">.estimate =</span> <span class="fu">mean</span>(.estimate),  <span class="at">.by =</span> <span class="st">&#39;origem&#39;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># criando a figura para visualizar os resultados</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.7</span>, <span class="dv">2</span>), </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;Modelo&#39;</span>, <span class="st">&#39;Baseline&#39;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&#39;Avaliação da solução preditiva&#39;</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&#39;Medimos o impacto do &lt;span style=&quot;color:#1E90FF&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; comparando a sua performance com a do &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;&#39;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&#39;Acurácia (maior é melhor)&#39;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">margin =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">units =</span> <span class="st">&#39;lines&#39;</span>)),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y   =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y   =</span> <span class="fu">element_line</span>(),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x   =</span> <span class="fu">element_line</span>()</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">1.25</span>, <span class="at">xmax =</span> <span class="fl">1.75</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">&#39;indianred&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.04</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>) <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">0.25</span>, <span class="at">xmax =</span> <span class="fl">0.75</span>, <span class="at">fill =</span> <span class="st">&#39;dodgerblue3&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.04</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">3</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>) <span class="sc">+</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># texto &#39;Baseline&#39; e linha de base</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> .estimate),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="sc">+</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">0.45</span>, <span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">str_wrap</span>(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Essa é a performance que obtemos quando assumimos que todas as instâncias pertencem à classe mais frequente, e é o patamar a partir do qual vamos definir se uma solução proposta representa uma melhoria ou não&#39;</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">60</span> </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.4</span>, <span class="at">y =</span> <span class="fl">0.74</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">str_wrap</span>(</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Esse é o impacto que pode ser atribuído ao modelo e, nesse caso, representa uma melhoria de performance&#39;</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">30</span> </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">xend =</span> <span class="fl">1.2</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">yend =</span> <span class="fl">0.68</span>), <span class="at">curvature =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">xend =</span> <span class="fl">0.3</span>, <span class="at">y =</span> <span class="fl">0.85</span>, <span class="at">yend =</span> <span class="fl">0.77</span>), <span class="at">curvature =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="index_files/figure-html/figura_classificacao_1-1.png" class="img-fluid" width="768" /></p>
</figure>
</div>
</div>
</div>
<p>O que esse exemplo mostra é que temos que tentar comparar a performance do modelo com o <em>baseline</em>, para saber se ele realmente está trazendo algum benefício. A magnitude desse benefício vai variar em função de algumas coisas, como a métrica de avaliação que resolvemos utilizar, a forma como implementamos o próprio <em>baseline</em> e, principalmente, a forma como essas duas coisas se combinam. Se tivéssemos predito que todas as instâncias pertenceriam à classe minoritária, teríamos uma acurácia do <em>baseline</em> muito menor, o que faria a performance do modelo ficar super inflada. Portanto, é super importante ter clareza de onde você quer partir com o seu <em>baseline</em> e como você pretende medir o benefício do que você vai desenvolver.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Uma breve nota sobre a escolha de métricas de avaliação
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Esse é um tema bastante complexo e que daria um post por si só. No entanto, acho importante salientar aqui (novamente) que a utilização da acurácia no exemplo acima é meramente ilustrativo, e que você não deve (no geral) ir direto nessa métrica em um problema de classificação.</p>
<p>Como discutiremos mais adiante, é importante olhar para o problema de negócio que queremos resolver quando definimos o <em>baseline</em> e uma métrica de avaliação, a fim de selecionarmos buscarmos uma solução que vá se aproximar do valor de negócio que queremos entregar. Por exemplo, se falsos positivos são críticos para o negócio (<em>i.e.</em>, o modelo prevê que uma instância pertence à uma classe A quando na realidade ela pertence à classe B), então talvez faça mais sentido buscar métricas que sejam mais impactadas por esse tipo de erro como a precisão e o AUCPr.</p>
<p>Outro exemplo relevante a se considerar é quando existe uma diferença grande na frequência entre múltiplas classes. Nesses casos, as métricas <em>micro</em> (calculadas com base nos valores absolutos dos erros e acertos de classificação entre todas as classes) são mais sensíveis à performance diferencial do modelo entre as classes do que as métricas <em>macro</em> (calculadas através da da média das métricas de performance por classe). Portanto, não subestime essa etapa no processo de um projeto de ciência de dados, pois ela é crítica para definir o sucesso da solução tanto do ponto de vista técnica quanto do de negócio.</p>
</div>
</div>
</div>
<p>Essa mesma lógica deve ser utilizada para todo outro passo durante a modelagem. Então, se você for otimizar os hiperparâmetros do modelo, testar novas variáveis e transformações e, até mesmo, mudar de algoritmo, você idealmente deve ter um baseline para definir o quanto cada nova tentativa está trazendo de benefício em cima do que você já tinha. Inclusive, você pode até considerar cada nova melhoria como um novo baseline que a sua próxima tentativa precisa bater. Um caso similar a este é apresentado na figura abaixo, onde aumentamos a complexidade de cada nova solução construindo sobre o que tínhamos anteriormente.</p>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(finetune) <span class="co"># para o tuning de hiperparâmetros</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger) <span class="co"># para a random forest</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                 Otimizando a regressão logística do exemplo inicial                  # </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># otimizando a regressão logística de forma mais simples</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="do">## primeiro setando o algoritmo</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>algoritmo <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;glmnet&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="do">## repetindo o pré-processamento do exemplo inicial</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>data_prep <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Status <span class="sc">~</span> Income <span class="sc">+</span> Amount <span class="sc">+</span> Debt <span class="sc">+</span> Price <span class="sc">+</span> Home <span class="sc">+</span> Job, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mean</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="do">## conectando os dados com o algoritmo</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(algoritmo) <span class="sc">%&gt;%</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(data_prep)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustando o algoritmo</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">tune_race_anova</span>(<span class="at">object =</span> wf, <span class="at">resamples =</span> splits, <span class="at">grid =</span> <span class="dv">20</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                              <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo o valor da acurácia do modelo treinado - a escolha dessa métrica é duvidosa</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># para esse tipo de problema, mas o exemplo aqui é apenas ilustrativo</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>metricas_glmnet_otimizado <span class="ot">&lt;-</span> wf <span class="sc">%&gt;%</span> </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="at">parameters =</span> <span class="fu">select_best</span>(<span class="at">x =</span> resultados, <span class="at">metric =</span> <span class="st">&#39;accuracy&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> splits, <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;accuracy&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;modelo otimizado&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                        Mudando o algoritmo do exemplo inicial                        # </span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co"># otimizando a regressão logística de forma mais simples</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="do">## primeiro setando o algoritmo</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>algoritmo <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;ranger&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="do">## conectando os dados com o algoritmo</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(algoritmo) <span class="sc">%&gt;%</span> </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(data_prep)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustando o algoritmo</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(<span class="at">object =</span> wf, <span class="at">resamples =</span> splits, </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                            <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy))</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo o valor da acurácia do modelo treinado - a escolha dessa métrica é duvidosa</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co"># para esse tipo de problema, mas o exemplo aqui é apenas ilustrativo</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>metricas_rf <span class="ot">&lt;-</span> resultados <span class="sc">%&gt;%</span> </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;accuracy&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;rf&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co">#           Visualizando e comparando os resultados entre as duas abordagens           # </span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co"># colocando tudo também em um objeto para que possamos criar a figura abaixo</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metricas_baseline_classe, metricas_modelo_classe, metricas_glmnet_otimizado, metricas_rf) <span class="sc">%&gt;%</span> </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate_std =</span> <span class="fu">sd</span>(.estimate), <span class="at">.estimate =</span> <span class="fu">mean</span>(.estimate),  <span class="at">.by =</span> <span class="st">&#39;origem&#39;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">origem =</span> <span class="fu">fct_relevel</span>(origem, <span class="st">&#39;modelo&#39;</span>, <span class="st">&#39;modelo otimizado&#39;</span>, <span class="st">&#39;rf&#39;</span>)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co"># criando a figura para visualizar os resultados</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.5</span>, <span class="fl">3.5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>), </span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;Random</span><span class="sc">\n</span><span class="st">Forest&#39;</span>, <span class="st">&#39;Regressão</span><span class="sc">\n</span><span class="st">Logística (tune)&#39;</span>, <span class="st">&#39;Regressão</span><span class="sc">\n</span><span class="st">Logística&#39;</span>, <span class="st">&#39;Baseline&#39;</span>)</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&#39;Avaliação da solução preditiva&#39;</span>,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&#39;Devemos medir progressivamente o impacto das nossas soluções para determinar se elas&lt;br&gt;estão trazendo melhorias ou não: &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; contra &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;, &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; contra &lt;span style=&quot;color:#191970&quot;&gt;&lt;b&gt;otimização do mesmo&lt;/b&gt;&lt;/span&gt;&lt;br&gt;e &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; contra &lt;span style=&quot;color:#CCAD00&quot;&gt;&lt;b&gt;outro modelo&lt;/b&gt;&lt;/span&gt;&#39;</span>,</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&#39;Acurácia (maior é melhor)&#39;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">margin =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">units =</span> <span class="st">&#39;lines&#39;</span>)),</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y   =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>),</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y   =</span> <span class="fu">element_line</span>(),</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x   =</span> <span class="fu">element_line</span>()</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># posicao dos retangulos mostrando a performance por solução</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">3.25</span>, <span class="at">xmax =</span> <span class="fl">3.75</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">&#39;indianred&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">2.25</span>, <span class="at">xmax =</span> <span class="fl">2.75</span>, <span class="at">fill =</span> <span class="st">&#39;dodgerblue3&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, </span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">1.25</span>, <span class="at">xmax =</span> <span class="fl">1.75</span>, <span class="at">fill =</span> <span class="st">&#39;midnightblue&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, </span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo otimizado&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, <span class="at">xmin =</span> <span class="fl">0.25</span>, <span class="at">xmax =</span> <span class="fl">0.75</span>, <span class="at">fill =</span> <span class="st">&#39;gold3&#39;</span>, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, </span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;rf&#39;</span>)<span class="sc">$</span>.estimate) <span class="sc">+</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># texto &#39;Baseline&#39; e linha de base</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> .estimate),</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># textos com o valor de acuracia por solução</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo otimizado&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;modelo otimizado&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;midnightblue&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;rf&#39;</span>)<span class="sc">$</span>.estimate <span class="sc">+</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;rf&#39;</span>)<span class="sc">$</span>.estimate, <span class="at">digits =</span> <span class="dv">4</span>), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&#39;gold3&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># textos explicativos</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&#39;Utilizar um &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; preditivo traz uma&lt;br&gt;melhora de performance frente ao &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;...&#39;</span>),</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&#39;...e, apesar da &lt;span style=&quot;color:#191970&quot;&gt;&lt;b&gt;otimização do modelo&lt;/b&gt;&lt;/span&gt;&lt;br&gt;também ser melhor que o &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;, ela&lt;br&gt;traz ganhos muito marginais quando&lt;br&gt;comparada à sua &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;versão normal&lt;/b&gt;&lt;/span&gt;...&#39;</span>),</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&#39;...algo que também ocorre quando mudamos&lt;br&gt;para &lt;span style=&quot;color:#CCAD00&quot;&gt;&lt;b&gt;outro modelo&lt;/b&gt;&lt;/span&gt;: sua performance é melhor&lt;br&gt;que a do &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;, mas não parece ser tão&lt;br&gt;melhor do que a do &lt;span style=&quot;color:#1873CD&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; mais simples.&#39;</span>),</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># setas</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fl">0.60</span>, <span class="at">yend =</span> <span class="fl">0.7</span>), <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">xend =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fl">0.58</span>, <span class="at">yend =</span> <span class="fl">0.7</span>), <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&#39;midnightblue&#39;</span>,</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">xend =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.63</span>, <span class="at">yend =</span> <span class="fl">0.7</span>), <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&#39;gold3&#39;</span>,</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="index_files/figure-html/figura_classificacao_2-1.png" class="img-fluid" width="768" /></p>
</figure>
</div>
</div>
</div>
<p>Até aqui temos considerado apenas a performance <em>média</em> de cada solução, mas não a sua variabilidade. Isso é igualmente relevante para sabermos se aquele benefício que estamos dizendo ter obtido pára de pé ou não. É nesse caso que os testes estatísticos entram para nos ajudar a definir se a solução que propomos é realmente diferente de um valor pré-determinado pelo <em>baseline</em> ou de uma outra solução. Para fazer esse tipo de comparação precisamos de algum tipo de <em>réplica</em> dos resultados da solução proposta, tal como a sua performance em cada um dos <em>folds</em> em uma base de validação cruzada ou seus resultados em N ajustes do algoritmo cujos pesos tenham sido inicializados aleatoriamente<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. De uma forma ou de outra, o ponto importante aqui é dar mais robustez e confiança para o que quer que você diga ser uma melhoria seja, realmente, uma melhoria.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Como comparar estatisticamente duas soluções?
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Vamos utilizar os resultados que obtivemos com o modelo de classificação para ilustrar dois casos nos quais poderíamos testar se uma solução proposta realmente representa uma melhoria.</p>
<p>Na primeira delas, vamos testar a hipótese alternativa de que a performance do modelo é superior àquela do <em>baseline</em>. Nese caso, vamos considerar o valor da performance do <em>baseline</em> como nossa hipótese nula, e utilizar um teste t para definir se a magnitude da diferença entre a performance do modelo é estatisticamente maior do que o valor (fixo) definido pelo <em>baseline</em>. Seguindo o exemplo que temos trabalhado até aqui, podemos ver que a Regressão Logística (padrão) traz sim uma melhora de performance quando comparado ao <em>baseline</em>. Portanto, isso nos assegura dizer que esta solução é sim uma melhoria frente ao que o <em>baseline</em> entregava. Se quiser uma explicação mais detalhada sobre testes de hipótese, você pode dar uma olhada nesse post <a href="https://nacmarino.netlify.app/posts/2021-12-11_notas-boardgames/">aqui</a>.</p>
<div class="cell">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt) <span class="co"># tabelas</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vamos utilizar a acuracia em cada fold de treino como uma replica em nosso teste </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estatistico</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> metricas_modelo_classe<span class="sc">$</span>.estimate, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a nossa hipotese alternativa diz que o valor da acuracia é maior no modelo</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do que no baseline. Portanto, a hipótese alternative possui uma direcionalidade</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e devemos utilizar um teste unicaudal para o nosso teste estatístico</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">&#39;greater&#39;</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a performance do baseline é praticamente idêntica em cada um dos folds de treino,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># uma vez que a separação da base foi balanceada e, portanto, tínhamos a mesma</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># quantidade de instâncias da classe majoritária em cada fold. Assim, podemos utilizar</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># o valor da média do baseline para ser o valor da média associado à nossa hipótese</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># nula</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">mean</span>(metricas_baseline_classe<span class="sc">$</span>.estimate)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pegando os resultados do teste-t e colocando eles num formato mais bonito</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pegando e ordenando as colunas que quero mostrar</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(method, alternative, statistic, parameter, p.value, conf.low, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ajustando algumas colunas para ficar mais fácil criar a tabela do gt</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">alternative =</span> <span class="st">&#39;(y &gt; mu)&#39;</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="at">yes =</span> <span class="st">&#39;&lt; 0.001&#39;</span>, <span class="at">no =</span> p.value)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.double), \(x) <span class="fu">round</span>(x, <span class="at">digits =</span> <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># criando a tabela do gt</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_merge</span>(<span class="at">columns =</span> <span class="fu">c</span>(estimate, conf.low), <span class="at">pattern =</span> <span class="st">&#39;{1} ({2} - Inf)&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&#39;&#39;</span>, <span class="at">alternative =</span> <span class="st">&#39;&#39;</span>, <span class="at">statistic =</span> <span class="st">&#39;t&#39;</span>, <span class="at">parameter =</span> <span class="st">&#39;df&#39;</span>, <span class="at">p.value =</span> <span class="st">&#39;p valor&#39;</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="st">&#39;Estimativa (95% IC)&#39;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="oufzdopptq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oufzdopptq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oufzdopptq thead, #oufzdopptq tbody, #oufzdopptq tfoot, #oufzdopptq tr, #oufzdopptq td, #oufzdopptq th {
  border-style: none;
}

#oufzdopptq p {
  margin: 0;
  padding: 0;
}

#oufzdopptq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oufzdopptq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oufzdopptq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oufzdopptq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oufzdopptq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oufzdopptq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oufzdopptq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oufzdopptq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oufzdopptq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oufzdopptq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oufzdopptq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oufzdopptq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oufzdopptq .gt_spanner_row {
  border-bottom-style: hidden;
}

#oufzdopptq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oufzdopptq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oufzdopptq .gt_from_md > :first-child {
  margin-top: 0;
}

#oufzdopptq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oufzdopptq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oufzdopptq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oufzdopptq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oufzdopptq .gt_row_group_first td {
  border-top-width: 2px;
}

#oufzdopptq .gt_row_group_first th {
  border-top-width: 2px;
}

#oufzdopptq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oufzdopptq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oufzdopptq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oufzdopptq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oufzdopptq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oufzdopptq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oufzdopptq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oufzdopptq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oufzdopptq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oufzdopptq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oufzdopptq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oufzdopptq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oufzdopptq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oufzdopptq .gt_left {
  text-align: left;
}

#oufzdopptq .gt_center {
  text-align: center;
}

#oufzdopptq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oufzdopptq .gt_font_normal {
  font-weight: normal;
}

#oufzdopptq .gt_font_bold {
  font-weight: bold;
}

#oufzdopptq .gt_font_italic {
  font-style: italic;
}

#oufzdopptq .gt_super {
  font-size: 65%;
}

#oufzdopptq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oufzdopptq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oufzdopptq .gt_indent_1 {
  text-indent: 5px;
}

#oufzdopptq .gt_indent_2 {
  text-indent: 10px;
}

#oufzdopptq .gt_indent_3 {
  text-indent: 15px;
}

#oufzdopptq .gt_indent_4 {
  text-indent: 20px;
}

#oufzdopptq .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="t">t</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="p valor">p valor</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Estimativa (95% IC)">Estimativa (95% IC)</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="method" class="gt_row gt_left">One Sample t-test</td>
<td headers="alternative" class="gt_row gt_left">(y &gt; mu)</td>
<td headers="statistic" class="gt_row gt_right">9.35</td>
<td headers="parameter" class="gt_row gt_right">4</td>
<td headers="p.value" class="gt_row gt_left">&lt; 0.001</td>
<td headers="estimate" class="gt_row gt_right">0.761 (0.751 - Inf)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Outra possibilidade é testar se duas soluções são realmente diferentes uma da outra. Nesse caso, vamos testar a hipótese alternativa de que existe diferença na performance das duas soluções (<em>i.e.</em>, tanto faz se uma é pior ou melhor que outra; ou seja, a diferença na performance das duas soluções é diferente de zero). Ainda seguindo os exemplos que temos, fizemos esse exercício comparando a solução da Regressão Logística com o Random Forest, e observamos que as duas soluções são estatisticamente similares - apesar da figura que tínhamos visto acima sugerir que a Random Forest seria uma opção ligeiramente melhor. Esse tipo de teste e aquele apresentado acima podem ser aplicados à praticamente qualquer tipo de solução que você desenvolver, e são importantes para nos ajudar a definir quão relevante são as melhorias que dizemos trazer.</p>
<div class="cell">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos agrupar os dados de performance da regressão logística e da random forest em</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># uma mesma tabela, pareando os resultados obtidos fold a fold (uma vez que utilizamos</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># o mesmo esquema de validação cruzada para treinar e avaliar cada algoritmo)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">select</span>(metricas_modelo_classe, id, <span class="at">estimate =</span> .estimate),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">select</span>(metricas_rf, id, <span class="at">estimate =</span> .estimate),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&#39;id&#39;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&#39;_modelo&#39;</span>, <span class="st">&#39;_baseline&#39;</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># utilizando a acuracia da regressão logistica em cada fold de treino como replicas</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># de um lado...</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> .<span class="sc">$</span>estimate_baseline, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ...e aquela da random forest em cada fold de treino do outro lado</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> .<span class="sc">$</span>estimate_modelo, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># como não nos importamos se uma solução é melhor ou pior do que a outra, vamos utilizar</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># um teste bicaudal</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a performance de cada solução foi medida nos mesmos folds de treino e, portanto, </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># as instâncias não são independentes entre si. Por conta disso, vamos usar um teste-t</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pareado, onde testamos se a diferença entre pares de observações é diferente de zero</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ou não. Em outras palavras, calculamos a diferença fold à fold, e avaliamos se a </span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># diferença das diferenças tende a zero</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">paired =</span> <span class="cn">TRUE</span>, </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># setando o valor da hipótese nula para 0: a diferença das diferenças na performance</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># das soluções tende a zero</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> <span class="dv">0</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pegando os resultados do teste-t e colocando eles num formato mais bonito</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ajustando algumas colunas para ficar mais fácil criar a tabela do gt</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(method, alternative, statistic, parameter, p.value, conf.low, estimate, conf.high) <span class="sc">%&gt;%</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.double), round, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alternative =</span> <span class="st">&#39;(baseline ≠ modelo)&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># criando a tabela do gt</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_merge</span>(<span class="at">columns =</span> <span class="fu">c</span>(estimate, conf.low, conf.high), <span class="at">pattern =</span> <span class="st">&#39;{1} ({2} à {3})&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&#39;&#39;</span>, <span class="at">alternative =</span> <span class="st">&#39;&#39;</span>, <span class="at">statistic =</span> <span class="st">&#39;t&#39;</span>, <span class="at">parameter =</span> <span class="st">&#39;df&#39;</span>, <span class="at">p.value =</span> <span class="st">&#39;p valor&#39;</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="st">&#39;Estimativa (95% IC)&#39;</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="qdfngunwcl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qdfngunwcl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qdfngunwcl thead, #qdfngunwcl tbody, #qdfngunwcl tfoot, #qdfngunwcl tr, #qdfngunwcl td, #qdfngunwcl th {
  border-style: none;
}

#qdfngunwcl p {
  margin: 0;
  padding: 0;
}

#qdfngunwcl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qdfngunwcl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qdfngunwcl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qdfngunwcl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qdfngunwcl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdfngunwcl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdfngunwcl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdfngunwcl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qdfngunwcl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qdfngunwcl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qdfngunwcl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qdfngunwcl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qdfngunwcl .gt_spanner_row {
  border-bottom-style: hidden;
}

#qdfngunwcl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qdfngunwcl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qdfngunwcl .gt_from_md > :first-child {
  margin-top: 0;
}

#qdfngunwcl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qdfngunwcl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qdfngunwcl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qdfngunwcl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qdfngunwcl .gt_row_group_first td {
  border-top-width: 2px;
}

#qdfngunwcl .gt_row_group_first th {
  border-top-width: 2px;
}

#qdfngunwcl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdfngunwcl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qdfngunwcl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qdfngunwcl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdfngunwcl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdfngunwcl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qdfngunwcl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qdfngunwcl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qdfngunwcl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdfngunwcl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdfngunwcl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdfngunwcl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdfngunwcl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdfngunwcl .gt_left {
  text-align: left;
}

#qdfngunwcl .gt_center {
  text-align: center;
}

#qdfngunwcl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qdfngunwcl .gt_font_normal {
  font-weight: normal;
}

#qdfngunwcl .gt_font_bold {
  font-weight: bold;
}

#qdfngunwcl .gt_font_italic {
  font-style: italic;
}

#qdfngunwcl .gt_super {
  font-size: 65%;
}

#qdfngunwcl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qdfngunwcl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qdfngunwcl .gt_indent_1 {
  text-indent: 5px;
}

#qdfngunwcl .gt_indent_2 {
  text-indent: 10px;
}

#qdfngunwcl .gt_indent_3 {
  text-indent: 15px;
}

#qdfngunwcl .gt_indent_4 {
  text-indent: 20px;
}

#qdfngunwcl .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="t">t</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="p valor">p valor</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Estimativa (95% IC)">Estimativa (95% IC)</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="method" class="gt_row gt_left">Paired t-test</td>
<td headers="alternative" class="gt_row gt_left">(baseline ≠ modelo)</td>
<td headers="statistic" class="gt_row gt_right">0.813</td>
<td headers="parameter" class="gt_row gt_right">4</td>
<td headers="p.value" class="gt_row gt_right">0.462</td>
<td headers="estimate" class="gt_row gt_right">0.004 (-0.009 à 0.016)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Eu foquei aqui no exemplo de <em>baseline</em> para o caso da classificação quando queremos prever uma classe para uma instância (<em>i.e.</em>, classificação em <em>hard labels</em>). O foco nesse tipo de problema aqui é porquê acredito que seja mais fácil de entender a necessidade de um <em>baseline</em>, além de ter um bocado de material disponível com esse tipo de exemplo e por esse ser um tipo de problema de dados bem comum no nosso dia a dia. Todavia, poderíamos pensar no mesmo processo para classificação focada na previsão de probabilidades (<em>i.e.</em>, <em>soft labels</em>), em problemas de regressão e previsão de séries temporais. Não vou entrar nos detalhes sobre cada um desses casos, mas deixo uns exemplos abaixo para àquelas pessoas que tiverem a curiosidade.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Exemplo de baseline para classificação em <em>soft labels</em>gb
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Podemos avaliar um modelo de classificação usando métricas baseadas em classes (<em>i.e.</em>, <em>hard labels</em>: acurácia, F1, sensibilidade,…) ou probabilidades (<em>i.e.</em>, <em>soft labels</em>: <em>log loss</em>, AUC,…). O exemplo acima usa uma classificação em <em>hard label</em>, mas também podemos pensar em um <em>baseline</em> para o caso de <em>soft labels</em>. Abaixo trabalhamos isso de forma similar ao que fizemos até então: assumindo que a classe mais frequente tem a label 0 e a classe menos frequente a label 1, e tendo em mente que vamos prever que todas as instâncias pertencem à label 0 (<em>i.e.</em>, classe mais frequente), vamos definir que o baseline será a probabilidade que descreve as amostras estarem mais próximas à label 0. Para isso, essa probabilidade será o complemento da frequência de ocorrência da classe mais comum<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<p>É importante notar que nesse caso estamos usando a <em>log loss</em> como métrica de avaliação, que é uma métrica onde valores menores são melhores. Nesse caso, esperamos que melhorias associadas aos modelos sejam representadas por valores de <em>log loss</em> menores do que aqueles observados para o <em>baseline</em>.</p>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#      Estimando a performance do baseline: probabilidade da classe mais frequente     #</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando uma probabilidade baseline para classificar todas as instâncias. Faremos </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># isso considerando que a classe mais frequente corresponde à label 0 e à menos frequente</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1; assim, se formos focar na log loss como métrica, o que queremos é que as probabilidades </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># associadas à label 0 estejam o mais próximas à 0 possível, e o contrário para àquelas</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># associadas à label 1. Dessa forma, precisaremos calcular a frequência da classe que vamos</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># considerar como a label 0 nesse exemplo (&#39;good&#39;) e subtrair 1 dela, de forma que o </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># complemento de sua frequência será um número mais próximo de 0 e será nosso baseline</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (alguns algoritmos de árvore, como o LightGBM, estimam um ponto de partida para o</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># cálculo das probabilidades na classificação de uma forma muito parecida)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>proba_frequente <span class="ot">&lt;-</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Status) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proba =</span> <span class="dv">1</span> <span class="sc">-</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Status <span class="sc">==</span> <span class="st">&#39;good&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(proba)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a performance do baseline focado em uma métrica contínua. Vamos manter o</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># padrão anterior e calcular a performance do baseline para cada fold, o que não vai fazer</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># diferença para esse caso da classificação, mas fará quando pensarmos em um exemplo de </span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># regressão. O codigo abaixo pega a base de treino de cada fold, diz que a probabilidade</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># prevista é aquela estimada acima e calcula a metrica de custo de log loss para cada</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># fold</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>metricas_baseline_proba <span class="ot">&lt;-</span> splits <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_fold =</span> <span class="fu">map</span>(splits, testing),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">proba      =</span> proba_frequente) <span class="sc">%&gt;%</span> </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>splits) <span class="sc">%&gt;%</span> </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="st">&#39;train_fold&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mn_log_loss</span>(Status, proba) <span class="sc">%&gt;%</span> </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;baseline&#39;</span>) </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">#             Quantificando a performance do modelo usando a mesma métrica             #</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># pegando o valor do log loss para cada um dos folds e tirando o valor da média entre todos</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># eles</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>metricas_modelo_proba <span class="ot">&lt;-</span> modelo <span class="sc">%&gt;%</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&#39;mn_log_loss&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;modelo&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co">#           Visualizando e comparando os resultados entre as duas abordagens           # </span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># colocando tudo também em um objeto para que possamos criar a figura abaixo</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metricas_baseline_proba, metricas_modelo_proba) <span class="sc">%&gt;%</span> </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate_std =</span> <span class="fu">sd</span>(.estimate), <span class="at">.estimate =</span> <span class="fu">mean</span>(.estimate),  <span class="at">.by =</span> <span class="st">&#39;origem&#39;</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">origem =</span> <span class="fu">fct_relevel</span>(origem, <span class="st">&#39;modelo&#39;</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co"># criando a figura para visualizar os resultados</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">fill =</span> origem), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="fl">0.7</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">color =</span> origem, </span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">round</span>(<span class="at">x =</span> .estimate, <span class="at">digits =</span> <span class="dv">3</span>)),</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.08</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&#39;Avaliação da solução preditiva&#39;</span>,</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&#39;Medimos o impacto do &lt;span style=&quot;color:#1E90FF&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; comparando a sua performance com a do &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;&#39;</span>,</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&#39;log loss (menor é melhor)&#39;</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">margin =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">units =</span> <span class="st">&#39;lines&#39;</span>)),</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y   =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x   =</span> <span class="fu">element_line</span>()</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># texto &#39;Baseline&#39; e linha de base</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>) <span class="sc">+</span> <span class="fl">0.005</span>, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> .estimate),</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="sc">+</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># observacoes sobre o modelo</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">0.95</span>, <span class="at">y =</span> <span class="fl">0.65</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">str_wrap</span>(</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Esta diferença é a melhoria na redução no erro de previsão que o modelo preditivo traz&#39;</span>,</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">35</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.64</span>, <span class="at">yend =</span> <span class="fl">0.55</span>), <span class="at">curvature =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># observacao sobre o baseline</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">1.95</span>, <span class="at">y =</span> <span class="fl">0.62</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">str_wrap</span>(</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Para métricas de erro to tipo &quot;menor, melhor&quot;, este é o patamar abaixo do qual uma solução precisa estar para que ela possa ser considerada uma melhoria&#39;</span>,</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">40</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">1.68</span>, <span class="at">xend =</span> <span class="fl">1.45</span>, <span class="at">y =</span> <span class="fl">0.7</span>, <span class="at">yend =</span> <span class="fl">0.6</span>), <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span>,</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">units =</span> <span class="st">&#39;in&#39;</span>)), <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="index_files/figure-html/exemplo_log_loss-1.png" class="img-fluid" width="768" /></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Exemplo de baseline em regressão
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A regressão envolve prever um valor contínuo e, portanto, podemos utilizar outro tipo de abordagem para estimar o <em>baseline</em>. Um jeito simples de fazer isso é utilizar a média da variável resposta para a previsão de qualquer novo valor. É importante ressaltar que o ideal é fazer isso através da base (ou fold) de treino para realizar a previsão na base de teste (ou fold de validação).</p>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#      Separando a base em treino e teste, e criando esquema de validação cruzada      #</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um split entre treino e teste, estratificando a separação da base pelo variável</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># que queremos usar no problema de classificação; além disso, setando uma constante para</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># o gerador de números aleatórios para garantir que vamos conseguir reproduzir o split</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>split_inicial_reg <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> hotel_rates, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> <span class="st">&#39;avg_price_per_room&#39;</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um esquema de validação cruzada para poder estimar a performance média do modelo </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># e a sua variância</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>splits_reg <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> <span class="fu">training</span>(split_inicial_reg), <span class="at">v =</span> <span class="dv">5</span>, <span class="at">strata =</span> <span class="st">&#39;avg_price_per_room&#39;</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                       Quantificando o baseline através da média                      #</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos calcular a média do valor do custo por quarto em cada fold de treino e, então, vamos</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># utilizar este valor para definir o que seria a nossa predicao do valor do quarto por instância</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># na base de teste daquele fold (isto é, vamos parear o valor médio do fold #1 de treino com</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># as instância do fold #1 de teste). Então, vamos calcular o valor do RMSE por fold e guardar</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># esse valor. Note que os valores da média do custo do quarto vão variar entre os folds, de</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># forma que o RMSE não será igual para todos os folds nesse caso aqui - e, portanto, o desvio</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># padrão não será zero</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>metricas_baseline_regressao <span class="ot">&lt;-</span> splits_reg <span class="sc">%&gt;%</span> </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">average =</span> <span class="fu">map_dbl</span>(<span class="at">.x =</span> splits, <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">training</span>(.x)<span class="sc">$</span>avg_price_per_room)),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">splits  =</span> <span class="fu">map</span>(<span class="at">.x =</span> splits, <span class="at">.f =</span> testing)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> splits) <span class="sc">%&gt;%</span> </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(avg_price_per_room, average) <span class="sc">%&gt;%</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;baseline&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#            Ajustando e estimando a performance de um algoritmo preditivo             # </span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co"># criando uma regressão linear simples para o problema de regressão</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="do">## primeiro setando o algoritmo</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>algoritmo <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;lm&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">&#39;regression&#39;</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="do">## criando o pré-processamento de dados que será aplicado durante o treinamento do modelo</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="do">## não há problema definir que o dado é de treinamento aqui, pois essa receita de</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="do">## pré-processamento só será treinada durante o ajuste do modelo</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>data_prep <span class="ot">&lt;-</span> <span class="fu">recipe</span>(avg_price_per_room <span class="sc">~</span> stays_in_weekend_nights <span class="sc">+</span> stays_in_week_nights <span class="sc">+</span> </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>                      near_christmas <span class="sc">+</span> near_new_years <span class="sc">+</span> country <span class="sc">+</span> meal <span class="sc">+</span> adults, </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial_reg)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_unknown</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_other</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="do">## conectando os dados com o algoritmo</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(algoritmo) <span class="sc">%&gt;%</span> </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(data_prep)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustando o algoritmo</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(<span class="at">object =</span> wf, <span class="at">resamples =</span> splits_reg, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo o valor do RMSE em cada fold de validação utilizando o modelo treinado</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>metricas_modelo_regressao <span class="ot">&lt;-</span> modelo <span class="sc">%&gt;%</span> </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;modelo&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#           Visualizando e comparando os resultados entre as duas abordagens           # </span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co"># colocando tudo também em um objeto para que possamos criar a figura abaixo.</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metricas_baseline_regressao, metricas_modelo_regressao) <span class="sc">%&gt;%</span> </span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate_std =</span> <span class="fu">sd</span>(.estimate), <span class="at">.estimate =</span> <span class="fu">mean</span>(.estimate),  <span class="at">.by =</span> <span class="st">&#39;origem&#39;</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">origem =</span> <span class="fu">fct_relevel</span>(origem, <span class="st">&#39;modelo&#39;</span>)</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="co"># criando a figura para visualizar os resultados</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">fill =</span> origem), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="fl">0.7</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">color =</span> origem, </span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">round</span>(<span class="at">x =</span> .estimate, <span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">8</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&#39;Avaliação da solução preditiva&#39;</span>,</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&#39;Medimos o impacto do &lt;span style=&quot;color:#1E90FF&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; comparando a sua performance com a do &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;: neste exemplo&lt;br&gt;de regressão, o &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt; é representado pelo valor da média da variável resposta na base de treino&#39;</span>,</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&#39;RMSE (menor é melhor)&#39;</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">margin =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">units =</span> <span class="st">&#39;lines&#39;</span>)),</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y   =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x   =</span> <span class="fu">element_line</span>()</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># texto &#39;Baseline&#39; e linha de base</span></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> .estimate <span class="sc">+</span> <span class="fl">0.3</span>),</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="index_files/figure-html/exemplo_regressao-1.png" class="img-fluid" width="768" /></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Exemplo de baseline em séries temporais
</div>
<div class='callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end'><i class='callout-toggle'></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Séries temporais são um caso especial de problema de predição, dada a dependência temporal entre observações. Por conta disso, existem algumas opções para a definição de um <em>baseline</em>, embora a escolha da forma dependa da características do próprio dado (<em>e.g.</em>, sazonalidade, tendência, frequência de amostragem). No caso do exemplo abaixo, temos uma série temporal com granularidade diária, e resolvi utilizar como <em>baseline</em> o valor do que queremos prever que foi observado no mesmo dia da semana anterior (<em>i.e.</em>, a previsão da quantidade de bicicletas alugadas no próximo sábado é a quantidade de bicicletas alugadas no sábado anterior). Esse tende a ser um <em>baseline</em> bem forte para esse tipo de dado e apesar de eu ter partido direto para ele aqui, o ideal é que você conduza algumas análises exploratórias no dado e conversas com o negócio para saber se esse tipo de coisa faz sentido.</p>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<details>
<summary>Código</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeltime) <span class="co"># series temporais</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk) <span class="co"># visualizacao de series temporais</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      Separando a base em treino e teste, e criando esquema de validação cruzada      #</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pegando um período mais curto de uma base com frequencia de amostragem diaria para o </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># exercicio. Vamos simular aqui como se quiséssemos um modelo para prever o valor da</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># variavel resposta para os proximos dias; como a base de dados está ordenada através</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># das datas, basta deixar as últimas 7 observações na base de teste e o resto no treino</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># além disso, não é preciso setar uma seed aqui, uma vez que o split de dados para uma</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># série temporal é determinístico na dimensão do tempo</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>split_inicial_ts <span class="ot">&lt;-</span> bike_sharing_daily <span class="sc">%&gt;%</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(dteday, <span class="fu">as.Date</span>(<span class="st">&#39;2012-09-01&#39;</span>), <span class="fu">as.Date</span>(<span class="st">&#39;2012-11-01&#39;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">time_series_split</span>(<span class="at">date_var =</span> dteday, <span class="at">initial =</span> <span class="fu">nrow</span>(.) <span class="sc">-</span> <span class="dv">7</span>, <span class="at">assess =</span> <span class="dv">7</span>) </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um esquema de validacao cruzada simples para avaliar a performance do algoritmo</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos criar N janelas deslizantes de 44 instâncias que serão usadas para treinar o </span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># algoritmo e as 7 observações seguintes serão usadas para testar a sua performance. O</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># esquema abaixo é suficiente para criar 5 dobras para a validação cruzada e, novamente,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># não é necessário setar uma seed uma vez que a divisão da base é determinística na</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># dimensão do tempo</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>splits_ts <span class="ot">&lt;-</span> <span class="fu">training</span>(split_inicial_ts) <span class="sc">%&gt;%</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">time_series_cv</span>(<span class="at">date_var =</span> dteday, <span class="at">initial =</span> <span class="dv">44</span>, <span class="at">assess =</span> <span class="dv">7</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#          Quantificando o baseline repetindo o valor observado 7 dias antes           #</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando o valor do baseline como o último valor registrado 7 dias antes; isto é, se</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># quisermos prever o valor da variavel resposta na segunda-feira, vamos apenas repetir o</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># valor que foi observado para ela na segunda-feira da semana anterior. Para isso, vamos</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># extrair as 7 últimas observações na base de treino de cada dobra e juntar os valores</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># observados para cada um dos dias com aqueles correspondentes de cada um dos 7 dias </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co"># seguintes que estão na mesma dobra da validacao cruzada. Uma vez que consigamos fazer</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># isto, basta entao calcular a metrica de erro para cada dobra</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>metricas_baseline_ts <span class="ot">&lt;-</span> splits_ts <span class="sc">%&gt;%</span> </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">previsao =</span> <span class="fu">map</span>(<span class="at">.x =</span> splits, <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">filter</span>(<span class="fu">training</span>(.x), dteday <span class="sc">&gt;=</span> <span class="fu">max</span>(dteday) <span class="sc">-</span> <span class="dv">6</span>)),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> previsao) <span class="sc">%&gt;%</span> </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="at">refday =</span> dteday, <span class="at">.estimate =</span> cnt) <span class="sc">%&gt;%</span> </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">dteday =</span> refday <span class="sc">+</span> <span class="dv">7</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> splits_ts <span class="sc">%&gt;%</span> </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">realizado =</span> <span class="fu">map</span>(<span class="at">.x =</span> splits, <span class="at">.f =</span> testing)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> realizado) <span class="sc">%&gt;%</span> </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(id, dteday, cnt), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;dteday&#39;</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(cnt, .estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;baseline&#39;</span>) </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co">#            Ajustando e estimando a performance de um algoritmo preditivo             # </span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um auto arima para o problema de previsao de séries temporais</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="do">## setando o algoritmo</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>algoritmo <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&#39;auto_arima&#39;</span>)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="do">## criando o pré-processamento de dados que será aplicado durante o treinamento do modelo</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="do">## não há problema definir que o dado é de treinamento aqui, pois essa receita de</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="do">## pré-processamento só será treinada durante o ajuste do modelo</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>data_prep <span class="ot">&lt;-</span> <span class="fu">recipe</span>(cnt <span class="sc">~</span> dteday <span class="sc">+</span> holiday <span class="sc">+</span> workingday, </span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> <span class="fu">training</span>(<span class="at">x =</span> split_inicial_ts)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">holiday    =</span> <span class="fu">as.factor</span>(holiday), </span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">workingday =</span> <span class="fu">as.factor</span>(workingday),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">encoding   =</span> <span class="fu">cyclic_encoding</span>(dteday, <span class="at">periods =</span> <span class="st">&#39;7d&#39;</span>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="do">## conectando os dados com o algoritmo</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(algoritmo) <span class="sc">%&gt;%</span> </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(data_prep)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="do">## ajustando o algoritmo</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(<span class="at">object =</span> wf, <span class="at">resamples =</span> splits_ts, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo o valor do RMSE do modelo treinado</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>metricas_modelo_ts <span class="ot">&lt;-</span> modelo <span class="sc">%&gt;%</span> </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origem =</span> <span class="st">&#39;modelo&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .metric, .estimate, origem)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co">#           Visualizando e comparando os resultados entre as duas abordagens           # </span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="co"># colocando tudo também em um objeto para que possamos criar a figura abaixo.</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(metricas_baseline_ts, metricas_modelo_ts) <span class="sc">%&gt;%</span> </span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">.estimate_std =</span> <span class="fu">sd</span>(.estimate), <span class="at">.estimate =</span> <span class="fu">mean</span>(.estimate),  <span class="at">.by =</span> <span class="st">&#39;origem&#39;</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">origem =</span> <span class="fu">fct_relevel</span>(origem, <span class="st">&#39;modelo&#39;</span>)</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="co"># criando a figura para visualizar os resultados</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">fill =</span> origem), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="fl">0.7</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> metricas, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> origem, <span class="at">y =</span> .estimate, <span class="at">color =</span> origem, </span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">round</span>(<span class="at">x =</span> .estimate, <span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">80</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">100</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;dodgerblue3&#39;</span>, <span class="st">&#39;indianred&#39;</span>)) <span class="sc">+</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&#39;Avaliação da solução preditiva&#39;</span>,</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&#39;Medimos o impacto do &lt;span style=&quot;color:#1E90FF&quot;&gt;&lt;b&gt;modelo&lt;/b&gt;&lt;/span&gt; comparando a sua performance com a do &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt;: neste exemplo de séries temporais,&lt;br&gt;o &lt;span style=&quot;color:#CD5C5C&quot;&gt;&lt;b&gt;baseline&lt;b&gt;&lt;/span&gt; é representado pela repetição do valor da variável resposta observado 7 dias antes (&lt;i&gt;e.g.&lt;/i&gt;, a previsão para este&lt;br&gt;domingo é o valor observado no domingo anterior)&#39;</span>,</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&#39;RMSE (menor é melhor)&#39;</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">margin =</span> <span class="fu">unit</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">units =</span> <span class="st">&#39;lines&#39;</span>)),</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y   =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x   =</span> <span class="fu">element_line</span>()</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># texto &#39;Baseline&#39; e linha de base</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(metricas, origem <span class="sc">==</span> <span class="st">&#39;baseline&#39;</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">yintercept =</span> .estimate <span class="sc">+</span> <span class="dv">4</span>),</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;indianred&#39;</span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="index_files/figure-html/exemplo_series_temporais-1.png" class="img-fluid" width="768" /></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Até aqui focamos muito naquilo que está nos livros-textos e outros materiais didáticos, além de falar no tecniquês na hora de definir um <em>baseline</em>. Entretanto, tem muita coisa que é igualmente relevante de considerarmos quando estamos no processo de definir um <em>baseline</em>, mas que normalmente não estão naquelas fontes e tendemos a aprender com o tempo. É à elas que vamos passar agora.</p>
</section>
<section id="isso-não-está-nos-livros" class="level1">
<h1>Isso não está nos livros…</h1>
<p>A primeira coisa (e uma das mais importantes) é ter um olho no negócio quando formos definir um <em>baseline</em>. Uma forma de fazer isso é olhando o próprio dado e pensando o que faz sentido para o negócio: o exemplo que trabalhamos lá no início usa um conjunto de dados de <em>scoring</em> de crédito, e nosso <em>baseline</em> diz que todos os clientes têm um bom <em>score</em>. Apesar da abordagem que utilizamos no exemplo ser prática comum, talvez ela não faça sentido para o negócio: não há como premissar que por padrão a empresa deva fornecer crédito para qualquer pessoa, assim como o contrário não deve ser razoável (<em>i.e.</em>, não fornecer crédito para ninguém).</p>
<p>Outra forma de pensar nessa definição do <em>baseline</em> é nem olhar o dado, mas buscar um <em>benchmark</em> do problema ou um <em>baseline</em> que o próprio negócio já tenha: pode ser que o objetivo da sua solução seja substituir um modelo que já é utilizado, então seu <em>baseline</em> pode ser a performance atual daquela solução. Isso é bastante similar ao que muitos papers que propõem algoritmos novos fazem: eles tentam bater uma ou mais métricas definidas pelo algoritmo que tenha o estado da arte para aquele problema. Um outro caso em que vi algo similar acontecer foi em um problema de previsão de séries temporais onde a pessoa mostrou que <em>en passant</em> que os dados que ela estava trabalhando variavam pouco, com uma diferença de menos do que 0.1 unidades entre observações sucessivas para mais do que 75% das observações na base dela. Isso poderia ter sido um ponto de partida para o <em>baseline</em> do problema que a pessoa estava tentando resolver, pois era um comportamento natural do dado fácil de prever no geral, mas que ela queria melhorar como um todo<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</p>
<p>Outra possibilidade é que a combinação entre olhar para os dados e olhar para o negócio. Conheço um caso no qual sempre que um evento <em>A</em> ocorria, o negócio tomava uma decisão <em>B</em> - e, olhando para os dados, era possível estimar que em até 75% das condições esta não era a melhor decisão a ser tomada. Nesse contexto, o objetivo da solução inicial nem tinha haver com melhorar esse processo de tomada de decisão, mas isso seria uma das consequências da solução. Portanto, uma abordagem foi utilizar àquela taxa de decisões não-ótimas como um <em>baseline</em> que a solução proposta deveria melhorar.</p>
<p>Esse mesmo processo também pode nos ajudar a definir quando simplesmente dizer não: quando as perspectivas de melhoria que uma solução vai trazer são tão baixas que talvez nem valha à pena uma tentativa. Conheço um caso no qual uma área de negócio possuía uma solução (não-analítica) para prever o custo de frete onde a taxa de erro era 5%, e eles estavam buscando por uma solução de aprendizado de máquina que chegasse a um erro menor. Nesse caso, pode ser muito difícil bater uma taxa de erro tão baixa e, talvez, uma solução de aprendizado de máquina nem seja o ideal para ajudar o negócio e/ou resolver o real problema que eles tinham ali<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>. No entanto, sem definir um <em>baseline</em> (o que vai ser e como medir) é difícil estabelecer a viabilidade de um projeto de ciência de dados, e ter aprendizado de máquina por ter não deve ser um caminho.</p>
</section>
<section id="para-além-de-algoritmos-preditivos" class="level1">
<h1>Para além de algoritmos preditivos</h1>
<p>Esse tipo de mentalidade que estamos falando aqui pode ser utilizada em qualquer etapa do que quer que você esteja fazendo, sempre que você quiser testar se o que está sendo proposto é realmente uma melhoria. Pode ser que estejamos pensando na performance de um código ou no padrão de cores utilizados em uma aplicação…se soubermos o que precisa ser melhorado e o que temos atualmente, fica mais fácil definir se as contribuições que fazemos estão fazendo alguma diferença ou não. E aqui não se esqueça de variar uma coisa por vez: por exemplo, se você alterar as cores dos botões e as posições dos mesmos, fica difícil definir o quanto cada uma dessas coisas contribui para mudanças no comportamento do usuário. Portanto, construa suas melhorias em camadas ou, ainda, desenhe uma forma de testar elas de forma que você consiga decompor o quanto cada alteração proposta contribui para o resultado que você está observando. Isso pode te ajudar a priorizar uma solução ao invés de duas ou mais, dando mais agilidade ao seu desenvolvimento e à entrega do valor que você precisa fazer no fim do dia.</p>
<p>Nesses casos também precisamos ter em mente se aquilo que queremos melhorar realmente é uma demanda de negócio ou se é uma demanda nossa mesmo. Já vi casos em que desenvolvedores trabalharam em componentes de alguns sistemas simplesmente porque estavam incomodados com o código e queriam melhorá-lo, apesar do código estar entregando o valor que o negócio precisava e o problema que existia ser outro. Também já vi algo similar acontecer em um outro nível: a primeira versão de um produto estava pronta mas, antes de liberá-la para os usuários e coletar feedbacks do que melhorar e por quê, o time já estava trabalhando na segunda versão com que só alterava como código rodava (<em>e.g.</em>, usar a função A ao invés da B), não o que ele entregava. E tudo bem trabalhar nessas melhorias técnicas, mas acredito que deva haver um propósito claro e mensurável para correr atrás desse esforço.</p>
<p>Uma última consideração sobre este tipo de abordagem é que ela também pode ser aplicada quando pensamos em IA Generativa. Estamos vivendo um momento de <em>hype</em> em que é natural achar que tudo é um prego para esse novo martelo, o que traz o risco de tentarmos colocar IA Generativa em qualquer tipo de solução que desenvolvamos. Sei que esse é um tema bastante sedutor e o medo de ficar de fora dessa novidade pode acabar fazendo com que sigamos por um caminho cujo caso de uso não pare de pé. Vi um exemplo disso há pouco tempo atrás, onde um grupo queria usar LLMs para responder perguntas simples sobre um arquivo Excel (e.g., <em>qual foi a nota do filme XPTO?</em>), quando existem outras soluções que fazem algo similar sem apelar para as LLMs<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. É claro que existem casos nos quais uma tecnologia como essa pode ser um grande acelerador, como quando queremos fazer algum tipo de classificação de texto mais simples. No entanto, não podemos nos esquecer que talvez uma versão mais simples dessa tecnologia já nos dê uma resposta satisfatória quando comparado à uma outra mais complexa (e cara; esse texto <a href="https://huyenchip.com/2024/02/28/predictive-human-preference.html">aqui</a> dá uma boa ideia sobre o assunto), assim como talvez uma solução como essa talvez nem traga uma melhoria tão significativa para o problema que você queira resolver. De toda forma, ter IA Generativa por ter não deve ser uma justificativa para trazer esse tipo de solução.</p>
<p>Finalmente, acredito que esses exemplos reforçam que o processo será sempre o mesmo para definir se algo o que estamos propondo é uma melhoria ou não. Precisamos buscar comparar duas coisas tentando controlar ao máximo a diferença entre elas; se conseguirmos fazer que a única diferença seja a <strong>intervenção</strong><a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> que estamos implementando (ou então conseguirmos alguma forma de controlar o efeito de outras fontes de variabilidade), então é muito plausível assumir que àquela <strong>intervenção</strong> contribui para chegar a um resultado diferente daquele que temos na <em>condição atual</em><a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>. Isso é a base do que chamamos de testes A/B, que têm toda uma formalidade para ser feita e validada, mas que muitas vezes em nosso cotidiano não precisamos ir tão fundo na teoria para começar a aplicá-los no que fazemos.</p>
<blockquote>
<p>A imagem de capa desse post foi gerada por uma IA Generativa, disponibilizada através do <code>ideogram.ai</code>. Para gerá-la, utilizei o prompt: A thought-provoking visual metaphor depicts a contemplative individual standing between two distinct doorways. On the left, a plain doorway with a simple sign reads “Adequate Solution,” exuding straightforwardness and stability. In contrast, the right doorway is intricately decorated, labeled “Complex Enigma,” evoking mystery and uncertainty. The person’s puzzled expression conveys their internal struggle as they weigh each choice. The ornate door’s atmosphere is enveloped in a whirlwind of ambiguous symbols and cryptic clues, foreshadowing the challenges and intricacies that await on their chosen path.</p>
</blockquote>
<blockquote>
<p>Gostaria de agradecer ao Gustavo Dimas Freitas por ler uma primeira versão deste post e pelos feedbacks dados, que ajudaram a melhorar a qualidade desse conteúdo. Também queria agradecer à Lirielly Vitorugo por pontuar algumas correções que precisava fazer no texto e ao Fellipe Gomes pela sugestão de incluir algum comentário sobre IA Generativa também.</p>
</blockquote>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Nicholas Marino</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Nicholas Marino</span> <span class="hidden" data-render-id="quarto-int-navbar:Sobre">Sobre</span> <span class="hidden" data-render-id="quarto-int-navbar:/about.html">/about.html</span> <span class="hidden" data-render-id="quarto-int-navbar:CV">CV</span> <span class="hidden" data-render-id="quarto-int-navbar:Portugues">Portugues</span> <span class="hidden" data-render-id="quarto-int-navbar:/cv/cv.html">/cv/cv.html</span> <span class="hidden" data-render-id="quarto-int-navbar:English">English</span> <span class="hidden" data-render-id="quarto-int-navbar:/cv/cv-en.html">/cv/cv-en.html</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://github.com/nacmarino/blog">https://github.com/nacmarino/blog</span> <span class="hidden" data-render-id="footer-center">Blog created with <a href="https://quarto.org/">Quarto</a> by Nicholas Marino. License: <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a>.</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Nicholas Marino - Tudo começa de algum lugar - até mesmo a sua solução analítica</span> <span class="hidden" data-render-id="quarto-twittercardtitle">Nicholas Marino - Tudo começa de algum lugar - até mesmo a sua solução analítica</span> <span class="hidden" data-render-id="quarto-ogcardtitle">Nicholas Marino - Tudo começa de algum lugar - até mesmo a sua solução analítica</span> <span class="hidden" data-render-id="quarto-metasitename">Nicholas Marino</span> <span class="hidden" data-render-id="quarto-twittercarddesc">A definição de um ponto de partida, um <em>baseline</em>, é vital no desenvolvimento de qualquer tipo de solução analítica. E, frequentemente, eu me pego falando sobre esse tema com pessoas cientistas de dados de todos os níveis de senioridade. Então, resolvi escrever esse post para compartilhar com um fórum maior o que eu normalmente ficou tagarelando com eles.</span> <span class="hidden" data-render-id="quarto-ogcardddesc">A definição de um ponto de partida, um <em>baseline</em>, é vital no desenvolvimento de qualquer tipo de solução analítica. E, frequentemente, eu me pego falando sobre esse tema com pessoas cientistas de dados de todos os níveis de senioridade. Então, resolvi escrever esse post para compartilhar com um fórum maior o que eu normalmente ficou tagarelando com eles.</span></p>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Não é no sentido ruim, mas sim no de ter bom-senso para julgar o que me é mostrado.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Isto é, algo robusto, generalizável, livre de artefatos, viéses ou frutos de relações espúrias.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Inclusive, essa é uma abordagem comum quando temos uma frequência muito desigual das categorias na base de dados, mas isso é estória para outro momento.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Vou abstrair muitas coisas nesses exemplos, como a forma como esse baseline precisa conversar com o objetivo do negócio, a métrica de avaliação, as etapas de preparação dos dados, pré-processamento e tudo o mais.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Algo que já vi ser comum para aplicações com redes neurais.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Considerando o caso da classificação binária, o objetivo aqui é simular o comportamneto do modelo em dar uma probabilidade próximo à 0 para uma instância pertencer a classe 1.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>No entanto, a pessoa acabou ignorando esse fato e partindo para uma solução analítica direto.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Afinal, tais modelos são apenas um componente de um processo muito maior, e pode ser que as ineficiências estejam escondidas em outros lugares.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Lembro de ter visto alguma coisa no PowerBI que podia ser utilizado para o mesmo propósito.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p><em>i.e.</em>, um <em>tratamento</em><a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p><em>i.e.</em>, um <em>baseline</em> ou <em>controle</em><a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/nacmarino\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<script src="https://giscus.app/client.js"
        data-repo="nacmarino/blog"
        data-repo-id="R_kgDOKH7ZGw"
        data-category="Announcements"
        data-category-id="DIC_kwDOKH7ZG84Cbmfw"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <div class='footer-contents'>Blog created with [Quarto](https://quarto.org/) by Nicholas Marino. License: [CC BY-SA 2.0](https://creativecommons.org/licenses/by-sa/2.0/).</div>  
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>

</body>

</html>